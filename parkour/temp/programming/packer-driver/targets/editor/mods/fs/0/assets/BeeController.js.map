{"version":3,"sources":["file:///Users/liuhongbo/Downloads/NaughtyMonkey/parkour/assets/BeeController.ts"],"names":["Animation","v2","_decorator","Component","RigidBody2D","find","Collider2D","Contact2DType","monkey_controller","ccclass","property","BEESTATE","BeeController","Number","ALIVE","judge","i","node","Math","abs","position","y","onBeginContact","selfCollider","otherCollider","contact","tag","state","DEAD","ani","getComponent","play","start","collider","on","BEGIN_CONTACT","ifreset","random","reset","setPosition","ltree","ltree_rgd","dir","setScale","ifmove","rgd","linearVelocity","speed","update","deltaTime","mk_controller","mk_state","x","during_time","judge_time","getPosition","getState","isPlaying","getScale","z","die"],"mappings":"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","sourcesContent":["\r\nimport {Animation,v2, _decorator, Component, Node, RigidBody2D, find, Collider2D, IPhysics2DContact, Contact2DType } from 'cc';\r\nimport { monkey_controller } from './monkey_controller';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * Predefined variables\r\n * Name = BeeController\r\n * DateTime = Wed Mar 16 2022 19:47:19 GMT+0800 (中国标准时间)\r\n * Author = AlexiosLHB\r\n * FileBasename = BeeController.ts\r\n * FileBasenameNoExtension = BeeController\r\n * URL = db://assets/BeeController.ts\r\n * ManualUrl = https://docs.cocos.com/creator/3.4/manual/zh/\r\n *\r\n */\r\n\r\nexport enum BEESTATE{\r\n    ALIVE,\r\n    DEAD\r\n}\r\n\r\n \r\n@ccclass('BeeController')\r\nexport class BeeController extends Component {\r\n    // [1]\r\n    // dummy = '';\r\n\r\n    // [2]\r\n    // @property\r\n    // serializableDummy = 0;\r\n    judge_time = 3;//10s\r\n    during_time = 0;\r\n    state:BEESTATE = BEESTATE.ALIVE;\r\n\r\n  \r\n\r\n    @property(Number)\r\n    y:number\r\n    @property(monkey_controller)\r\n    mk_controller:monkey_controller;\r\n    @property(Number)\r\n    speed:number\r\n\r\n    judge(){\r\n        for(var i =1;i<5;i++){\r\n            var node = find(\"Canvas/Hedgehog\"+i);\r\n            if(Math.abs(node.position.y-this.y)<=250 )return false;\r\n        }\r\n        return true;\r\n    }\r\n    onBeginContact (selfCollider: Collider2D, otherCollider: Collider2D, contact: IPhysics2DContact | null) {\r\n   \r\n        // 只在两个碰撞体开始接触时被调用一次\r\n       \r\n\r\n        if(otherCollider.tag==2){\r\n        this.state=BEESTATE.DEAD;\r\n        let ani = this.node.getComponent(Animation);\r\n        ani.play(\"Bee_Smoke\");\r\n        }\r\n\r\n\r\n\r\n\r\n    }\r\n    start () {\r\n        let collider = this.getComponent(Collider2D);\r\n        if(collider){\r\n            collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n        }\r\n\r\n        let ifreset = Math.random();\r\n        if(ifreset<0.15&&this.judge())this.reset();\r\n        else this.node.setPosition(0,-1000,0);\r\n\r\n        \r\n        // [3]\r\n    }\r\n\r\n    reset(){\r\n\r\n        let ani = this.node.getComponent(Animation);\r\n        ani.play(\"Bee_Idle\");\r\n        this.state=BEESTATE.ALIVE;\r\n     \r\n        let ltree = find(\"Canvas/ltree\");\r\n        let ltree_rgd = ltree.getComponent(RigidBody2D);\r\n  \r\n        this.node.setPosition(Math.random()*(200+186)-186,this.y,0);\r\n        let dir = Math.random();\r\n        if(dir<0.5){\r\n            this.node.setScale(-0.25,0.25,0.25);\r\n        }\r\n        else {\r\n            this.node.setScale(0.25,0.25,0.25);\r\n        }\r\n        let ifmove = Math.random();\r\n        if(ifmove>0.5){\r\n            let rgd = this.node.getComponent(RigidBody2D);\r\n            if(dir<0.5){\r\n                rgd.linearVelocity=v2(-5,this.speed);\r\n            }\r\n            else{\r\n                rgd.linearVelocity=v2(5,this.speed);\r\n\r\n            }\r\n        }\r\n        else{\r\n            let rgd = this.node.getComponent(RigidBody2D);\r\n            rgd.linearVelocity=v2(0,this.speed);\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    update (deltaTime: number) {\r\n        if(this.mk_controller.mk_state == 0){\r\n\r\n            let ltree = find(\"Canvas/ltree\");\r\n            let ltree_rgd = ltree.getComponent(RigidBody2D);\r\n            let rgd = this.getComponent(RigidBody2D);\r\n        this.speed = ltree_rgd.linearVelocity.y;\r\n        rgd.linearVelocity=v2(rgd.linearVelocity.x,this.speed);\r\n     \r\n\r\n     \r\n        this.during_time +=deltaTime;\r\n        // [4]\r\n        if(this.during_time>this.judge_time&&this.node.getPosition().y<-870){\r\n            this.during_time = 0;\r\n     \r\n            let ifreset = Math.random();\r\n            if(ifreset<0.5&&this.judge())\r\n            this.reset();\r\n        }\r\n       let ani = this.node.getComponent(Animation);\r\n\r\n    if(this.state == BEESTATE.DEAD&&ani.getState(\"Bee_Smoke\").isPlaying==false){\r\n        this.state=BEESTATE.ALIVE;\r\n        this.node.setPosition(0,-1000,0);\r\n    }\r\n           \r\n\r\n           \r\n            if(this.node.getPosition().x<=-186||this.node.getPosition().x>=200){\r\n            rgd.linearVelocity = v2(-rgd.linearVelocity.x,rgd.linearVelocity.y);\r\n            this.node.setScale(-this.node.getScale().x,this.node.getScale().y,this.node.getScale().z);\r\n        \r\n            }\r\n        \r\n        }\r\n\r\n    }\r\n\r\n    die() {\r\n        this.node.getComponent(Animation).play('Bee_Smoke');\r\n    }\r\n}\r\n\r\n/**\r\n * [1] Class member could be defined like this.\r\n * [2] Use `property` decorator if your want the member to be serializable.\r\n * [3] Your initialization goes here.\r\n * [4] Your update function goes here.\r\n *\r\n * Learn more about scripting: https://docs.cocos.com/creator/3.4/manual/zh/scripting/\r\n * Learn more about CCClass: https://docs.cocos.com/creator/3.4/manual/zh/scripting/decorator.html\r\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.4/manual/zh/scripting/life-cycle-callbacks.html\r\n */\r\n"]}