{"version":3,"sources":["file:///Users/liuhongbo/parkour/assets/HedgehogController.ts"],"names":["Animation","_decorator","Component","find","RigidBody2D","v2","Collider2D","Contact2DType","monkey_controller","ccclass","property","HedgehogSTATE","HedgehogController","Number","IDLE","moveway","ifrun","Math","random","ani","getComponent","rgd","run_possibility","node","getScale","x","linearVelocity","speed","state","DOWNRUNNING","UPRUNNING","play","judgerun","y","getPosition","i","name","abs","position","bee_node","judge","reset","up_or_down","l_or_r","setScale","setPosition","onBeginContact","selfCollider","otherCollider","contact","tag","DEAD","start","collider","on","BEGIN_CONTACT","ifup","up_possibility","update","deltaTime","mk_controller","mk_state","ltree","ltree_rgd","during_time","getState","isPlaying","judge_time","ifrevert","revert_possibility","z"],"mappings":"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","sourcesContent":["\nimport { Animation,_decorator, Component, Node, find, RigidBody2D, v2, TypeScript, Collider2D, IPhysics2DContact, Contact2DType, director } from 'cc';\nimport { CanvasController } from './CanvasController';\nimport { monkey_controller } from './monkey_controller';\nconst { ccclass, property } = _decorator;\n\n/**\n * Predefined variables\n * Name = HedgehogController\n * DateTime = Tue Mar 15 2022 09:20:12 GMT+0800 (中国标准时间)\n * Author = AlexiosLHB\n * FileBasename = HedgehogController.ts\n * FileBasenameNoExtension = HedgehogController\n * URL = db://assets/HedgehogController.ts\n * ManualUrl = https://docs.cocos.com/creator/3.4/manual/zh/\n *\n */\nenum HedgehogSTATE{\n    UPRUNNING,\n    DOWNRUNNING,\n    IDLE,\n    DEAD\n}\n \n@ccclass('HedgehogController')\nexport class HedgehogController extends Component {\n    during_time:number=0;\n    state:HedgehogSTATE = HedgehogSTATE.IDLE;\n\n  \n\n    @property(Number)\n    y:number\n    @property(Number)\n    judge_time:number;\n    @property(Number)\n    run_possibility:number;\n    @property(Number)\n    up_possibility:number;\n    @property(Number)\n    revert_possibility:number;\n\n    @property(monkey_controller)\n    mk_controller:monkey_controller;\n\n    @property(Number)\n    speed:number\n\n\n   \n\n    \n    // [1]\n    // dummy = '';\n\n    // [2]\n    // @property\n    // serializableDummy = 0;\n    moveway(){\n    \n\n        let ifrun = Math.random();\n        let ani = this.getComponent(Animation);\n        let rgd = this.getComponent(RigidBody2D);\n        if(ifrun<this.run_possibility){\n\n            if(this.node.getScale().x<0){\n                rgd.linearVelocity=v2(0,this.speed-3);\n                this.state = HedgehogSTATE.DOWNRUNNING;\n            }\n            \n            else  {\n                rgd.linearVelocity=v2(0,this.speed+3);\n                this.state=HedgehogSTATE.UPRUNNING;\n            }\n            ani.play(\"Hedgehog_Walking\");\n\n        }\n        else{\n            rgd.linearVelocity=v2(0,this.speed);\n            this.state=HedgehogSTATE.IDLE;\n            ani.play(\"Hedgehog_Idle\");\n\n        }\n    }\n    judgerun(){\n        var y = this.node.getPosition().y;\n        for(var i =1;i<5;i++){\n            var node = find(\"Canvas/Hedgehog\"+i);\n            if(\"Hedgehog\"+i != this.node.name&&Math.abs(node.position.y-y)<=300)return false;\n        }\n        var bee_node = find(\"Canvas/Bee\");\n        if(Math.abs(bee_node.position.y-y)<=300)return false;\n        return true;\n    }\n    judge(){\n        for(var i =1;i<5;i++){\n            var node = find(\"Canvas/Hedgehog\"+i);\n            if(Math.abs(node.position.y-this.y)<=300)return false;\n        }\n        var bee_node = find(\"Canvas/Bee\");\n        if(Math.abs(bee_node.position.y-this.y)<=300)return false;\n        return true;\n    }\n    reset(){\n        let up_or_down = Math.random();\n\n        let l_or_r = Math.random();\n            if(l_or_r>0.5){\n                if(up_or_down<0.5){\n                this.node.setScale(-0.25,0.25,0.25);\n                }\n                else \n                {\n                    this.node.setScale(0.25,0.25,0.25);\n                }\n                this.node.setPosition(340,this.y,0);\n               \n\n            }\n            else{\n                if(up_or_down<0.5)\n                this.node.setScale(-0.25,-0.25,0.25);\n                else\n                this.node.setScale(0.25,-0.25,0.25);\n                this.node.setPosition(-326,this.y,0);\n            }\n            this.moveway();\n\n\n    }\n    onBeginContact (selfCollider: Collider2D, otherCollider: Collider2D, contact: IPhysics2DContact | null) {\n   \n        // 只在两个碰撞体开始接触时被调用一次\n        if(otherCollider.tag == 2){\n        this.state = HedgehogSTATE.DEAD;\n        let rgd = this.node.getComponent(RigidBody2D);\n        rgd.linearVelocity = v2(0,this.speed);\n        let ani = this.node.getComponent(Animation);\n        ani.play(\"Hedgehog_Smoke\");\n        }\n       \n\n    }\n\n\n\n\n    start () {\n        let collider = this.getComponent(Collider2D);\n        if(collider){\n            collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\n        }\n        let ifup = Math.random();\n        if(ifup<this.up_possibility){\n            this.reset();\n        }\n        else{\n            this.node.setPosition(340,-1000,0);\n        }\n        // [3]\n    }\n\n    update (deltaTime: number) {\n        \n      if(this.mk_controller.mk_state == 0){\n        let ltree = find(\"Canvas/ltree\");\n        let ltree_rgd = ltree.getComponent(RigidBody2D);\n       \n      \n\n        this.during_time+=deltaTime;\n        let rgd = this.getComponent(RigidBody2D);\n        this.speed = ltree_rgd.linearVelocity.y;\n      \n\n        //update speed\n        switch(this.state){\n            case  HedgehogSTATE.DOWNRUNNING:\n                rgd.linearVelocity = v2(0,this.speed-3);\n                break;\n            case HedgehogSTATE.UPRUNNING:\n                rgd.linearVelocity = v2(0,this.speed+3);\n                break;\n            case  HedgehogSTATE.IDLE:\n                rgd.linearVelocity = v2(0,this.speed);\n                break;\n            case HedgehogSTATE.DEAD:\n                let ani = this.node.getComponent(Animation);\n               \n                if(ani.getState(\"Hedgehog_Smoke\").isPlaying==false){\n              \n\n                    this.state = HedgehogSTATE.IDLE;\n                    rgd.linearVelocity = v2(0,this.speed);\n                    this.node.setPosition(340,-1000,0);\n                   \n                }\n                break;\n\n\n\n\n        }\n\n\n\n    \n\n\n\n\n\n        if(this.during_time>this.judge_time&& this.node.getPosition().y<-870&&this.judge())\n        {\n\n            this.during_time = 0;\n            let ifrevert = Math.random();\n            if(ifrevert<this.revert_possibility){\n                this.reset();\n            }\n        }\n        let ani = this.getComponent(Animation);\n\n        if(ani.getState(\"Hedgehog_Walking\").isPlaying == true){\n          \n           \n            if(this.judgerun()==false){\n               \n                if(this.state == HedgehogSTATE.DOWNRUNNING){\n                    this.state=HedgehogSTATE.UPRUNNING;\n                    this.node.setScale(0.25,this.node.getScale().y,this.node.getScale().z);\n                \n                    rgd.linearVelocity = v2(0,this.speed+3);\n                }\n                else if(this.state == HedgehogSTATE.UPRUNNING){\n                    this.state = HedgehogSTATE.DOWNRUNNING;\n                    this.node.setScale(-0.25,this.node.getScale().y,this.node.getScale().z);\n                   \n                    rgd.linearVelocity = v2(0,this.speed-3);\n\n                }\n            }\n\n        }\n    \n\n\n\n\n      }\n        // [4]\n    }\n}\n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.4/manual/zh/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.4/manual/zh/scripting/decorator.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.4/manual/zh/scripting/life-cycle-callbacks.html\n */\n"]}